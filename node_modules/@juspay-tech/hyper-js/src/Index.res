open Types

let loadHyper = (str, option) => {
  Js.Promise.make((~resolve, ~reject) => {
    let sessionID = generateSessionID()
    let timeStamp = Js.Date.now() // 10 keys, 15 keys
    // 10 keys
    // 15 keys
    // 12 keys
    // let analyticsObj= []
    //https://beta.orca.juspay.io/orca/elements/0.0.24/OrcaLoader.js
    let scriptURL = "https://beta.hyperswitch.io/v1/HyperLoader.js"
    let script = Window.createElement("script")
    script->Window.elementSrc(scriptURL)
    script->Window.elementOnload(() => {
      switch OrcaJs.hyperInstance->Js.Nullable.toOption {
      | Some(instance) =>
        Js.log2("INSTANCE", instance(str, option, sessionID))
        resolve(. instance(str, option, sessionID))
      | None => ()
      }
    })
    script->Window.elementOnerror(err => {
      reject(. err)
    })
    Window.body->Window.appendChild(script)
  })
}

let loadStripe = (str, option) => {
  Js.Console.warn("loadStripe is deprecated. Please use loadHyper instead.")
  loadHyper(str, option)
}

let \"Hyper" = (str, option) => {
  let sessionID = generateSessionID()
  switch OrcaJs.hyperInstance->Js.Nullable.toOption {
  | Some(instance) => instance(str, option, sessionID)
  | None => emptyHyperInstance
  }
}

let \"Stripe" = (str, option) => {
  Js.Console.warn("Stripe is deprecated. Please use Hyper instead.")
  \"Hyper"(str, option)
}
